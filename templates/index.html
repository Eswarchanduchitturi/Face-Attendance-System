{% extends "base.html" %}
{% block content %}

<div class="row justify-content-center fade-in">
    <div class="col-lg-8">

        <div class="frosted-card text-center">
            <h4 class="mb-3">
                <i class="fa-solid fa-camera"></i> Live Face Recognition
            </h4>

            <!-- VIDEO FEED (NO SRC BY DEFAULT) -->
            <img id="videoFeed"
                 class="img-fluid rounded mb-3 d-none"
                 style="border:1px solid rgba(255,255,255,0.2);
                        max-height:420px;" />

            <!-- CONTROLS -->
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-success px-4" onclick="cameraOn()">
                    <i class="fa-solid fa-play"></i> Camera ON
                </button>
                <button class="btn btn-danger px-4" onclick="cameraOff()">
                    <i class="fa-solid fa-stop"></i> Camera OFF
                </button>
            </div>

            <!-- STATUS -->
            <p id="camStatus" class="mt-3 text-info fw-semibold">
                Camera Status: OFF
            </p>
        </div>
        <div id="attendanceMsg"
     class="alert d-none mt-3"
     role="alert"></div>

    </div>
</div>

<script>
async function cameraOn() {
    await fetch("/camera/on");   // ✅ TURN BACKEND CAMERA ON

    const img = document.getElementById("videoFeed");
    img.src = "/video";
    img.classList.remove("d-none");

    document.getElementById("camStatus").innerText =
        "Camera Status: ON";
}

async function cameraOff() {
    await fetch("/camera/off");  // ✅ TURN BACKEND CAMERA OFF

    const img = document.getElementById("videoFeed");
    img.src = "";
    img.classList.add("d-none");

    document.getElementById("camStatus").innerText =
        "Camera Status: OFF";
}
</script>
<script>
setInterval(async () => {
    const res = await fetch("/attendance_status");
    const data = await res.json();

    const box = document.getElementById("attendanceMsg");

    if (data.status === "success") {
        box.className = "alert alert-success mt-3";
        box.innerText = "✅ Attendance Captured Successfully";
        box.classList.remove("d-none");

        setTimeout(() => box.classList.add("d-none"), 3000);
    }

    if (data.status === "failed") {
        box.className = "alert alert-danger mt-3";
        box.innerText = "❌ Attendance Capture Failed";
        box.classList.remove("d-none");

        setTimeout(() => box.classList.add("d-none"), 3000);
    }
}, 1500); // check every 1.5 seconds
</script>


{% endblock %}
